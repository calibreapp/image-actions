# Image Actions

Image Actions automatically compress JPEG, PNG and WebP images in GitHub Pull Requests.

- **Fast, efficient and near-lossless compression**
- Uses the best image compression algorithms available: [mozjpeg](https://github.com/mozilla/mozjpeg) and [libvips](https://github.com/libvips/libvips)
- Configurable and extensible: use default settings or adapt to your needs
- Runs in [GitHub Actions](https://github.com/features/actions)
- Built by web performance experts at [Calibre](https://calibreapp.com/); a  performance monitoring platform

![Preview of image-actions Pull Request comment](https://user-images.githubusercontent.com/924/62024579-e1470d00-b218-11e9-8655-693ea42ba0f7.png)

## Add Image Actions to your repository

1. Open or create the `.github/workflows/calibreapp-image-actions.yml` file.
2. Paste in the following:

```yml
name: Compress images
on: pull_request
jobs:
  build:
    name: calibreapp/image-actions
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - name: calibreapp/image-actions
        uses: docker://calibreapp/github-image-actions
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

The `GITHUB_TOKEN` secret is [automatically generated by GitHub](https://help.github.com/en/articles/virtual-environments-for-github-actions#github_token-secret). This automatic token is [scoped only to the repository that is currently running the action.](https://help.github.com/en/articles/virtual-environments-for-github-actions#token-permissions)

## Configure Image Actions

By default, you probably don’t need to configure `image-actions`. However, if you’d like to ignore specific file paths, or change image compression options, read on.

Change the configuration options by adding a `.github/calibre/image-actions.yml` file:

```yml
jpeg:
  quality: 80
png:
  quality: 80
webp:
  quality: 80
ignorePaths:
  - "node_modules/**"
```

- The above configuation is what `image-actions` uses by default
- The `jpeg`, `png` and `webp` config keys will be delivered directly into [sharp’s](http://sharp.pixelplumbing.com) `toFormat`. ([JPEG options](http://sharp.pixelplumbing.com/en/stable/api-output/#jpeg), [PNG options](http://sharp.pixelplumbing.com/en/stable/api-output/#png), [Webp options](http://sharp.pixelplumbing.com/en/stable/api-output/#webp))
- `ignorePaths` allows for path globbing [see the glob package for more details](https://www.npmjs.com/package/glob)

## Running image-actions ONLY when images are changed

image-actions is designed to run for each pull request. On some repositories, images are seldom updated. To run image-actions only when images have been changed, use GitHub action's `[on.push.paths](https://help.github.com/en/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions#onpushpull_requestpaths)` workflow configuration:

```yml
name: Compress images
on: pull_request
  paths:
    - '**.jpg'
    - '**.png'
    - '**.webp'
```

The above workflow will only run image-actions when `jpg`, `png` or `webp` files are changed.

## Links and Resources

- **[Announcement post: Automatically compress images on Pull Requests](https://calibreapp.com/blog/compress-images-in-prs/)**
- [Image Actions on GitHub Marketplace](https://github.com/marketplace/actions/image-actions)
- [mozjpeg](https://github.com/mozilla/mozjpeg)
- [libvips](https://github.com/libvips/libvips)
- [Learn more about GitHub Actions](https://github.com/features/actions)
- [Start monitoring your sites performance](https://calibreapp.com/)
